<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Confirmar Presen√ßa - Maria Alice</title>

  <style>
    :root{
      --bg1:#fff3e7;
      --bg2:#ffe0c2;
      --card:#ffffffcc;
      --stroke:#00000010;
      --text:#1d1d1d;
      --muted:#4b4b4b;
      --accent:#e63946;
      --shadow: 0 18px 50px rgba(0,0,0,.12);
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);

      background-image: url("fundo.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;

      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
    }

    .wrap{ width:min(560px, 100%); }

    .card{
      background: rgba(255,255,255,0.9);
      border:1px solid var(--stroke);
      border-radius:24px;
      box-shadow: var(--shadow);
      padding:22px;
    }

    .tag{
      display:inline-flex;
      gap:10px;
      align-items:center;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid #00000012;
      background:#ffffffd6;
      font-size:13px;
      font-weight:800;
    }

    .dot{
      width:10px;height:10px;border-radius:50%;
      background:var(--accent);
      box-shadow:0 0 0 4px #e6394620;
    }

    h1{ margin:12px 0 6px; font-size:28px; }
    p{ margin:0 0 14px; color:var(--muted); }

    form{
      background:#fff;
      border:1px solid #00000012;
      border-radius:18px;
      padding:14px;
    }

    label{
      display:block;
      font-size:12px;
      font-weight:900;
      letter-spacing:.8px;
      text-transform:uppercase;
      margin:12px 0 6px;
      color:#4b4b4b;
    }

    input, textarea, select{
      width:100%;
      padding:12px;
      border-radius:14px;
      border:1px solid #00000018;
      font-size:14px;
      background:#fffdfb;
    }

    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }

    @media(max-width:520px){
      .row{ grid-template-columns:1fr; }
    }

    /* Anima√ß√£o suave */
    .fade-box{
      overflow:hidden;
      max-height:0;
      opacity:0;
      transform: translateY(-6px);
      transition: all .35s ease;
    }
    .fade-box.show{
      max-height:120px;
      opacity:1;
      transform: translateY(0);
      margin-top:8px;
    }

    .btn{
      width:100%;
      margin-top:16px;
      padding:14px;
      border-radius:16px;
      border:none;
      font-weight:900;
      font-size:14px;
      cursor:pointer;
      background:linear-gradient(90deg,var(--accent),#ff6b6b);
      color:#2b070a;
    }

    .status{
      margin-top:12px;
      padding:12px;
      border-radius:14px;
      border:1px dashed;
      display:none;
      font-size:13px;
    }

    .status.ok{
      background:#eaf8f5;
      border-color:#2a9d8f55;
      color:#0b3a34;
    }

    .status.err{
      background:#ffecec;
      border-color:#e6394655;
      color:#4a0b10;
    }

    .foot{
      margin-top:12px;
      text-align:center;
      font-size:12px;
      color:#555;
    }

    /* ‚úÖ TELA FINAL (foto fullscreen) */
    .final-screen{
      position: fixed;
      inset: 0;
      display: none;          /* escondido at√© o sucesso */
      align-items: center;
      justify-content: center;
      background: #000;
      z-index: 999999;
      overflow: hidden;
    }
    .final-screen.show{
      display: flex;
      animation: fadeIn .25s ease;
    }

    .final-photo{
      width: 100%;
      height: 100%;
      object-fit: cover;      /* tela cheia mantendo propor√ß√£o */
      object-position: center;
      display:block;
    }

    .final-close{
      position: absolute;
      top: 14px;
      right: 14px;
      border: none;
      background: rgba(255,255,255,.90);
      border-radius: 999px;
      padding: 10px 12px;
      font-weight: 900;
      cursor: pointer;
      z-index: 2;
    }

    @keyframes fadeIn{
      from{ opacity:0; }
      to{ opacity:1; }
    }
  </style>
</head>

<body>
  <!-- ‚úÖ Foto final em tela cheia -->
  <div class="final-screen" id="finalScreen" aria-hidden="true">
    <button class="final-close" id="finalClose" type="button">‚úñ</button>
    <!-- Troque o nome do arquivo se quiser -->
    <img class="final-photo" src="foto_final.jpg" alt="Obrigado!">
  </div>

  <div class="wrap">
    <div class="card">
      <div class="tag"><span class="dot"></span> Confirma√ß√£o ‚Ä¢ Maria Alice (1 aninho) üçâ</div>

      <h1>Preencha para confirmar</h1>
      <p>Ao enviar, sua confirma√ß√£o ser√° registrada automaticamente.</p>

      <iframe id="hidden_iframe" name="hidden_iframe" style="display:none;"></iframe>

      <form id="rsvpForm"
        action="https://script.google.com/macros/s/AKfycbwf3Pw9OFYRmNhpLzOaRW_k_g_C4eJnyZOaag4MC-2mGst2ad7SvrVAA-dp9U0-RYQ/exec"
        method="POST"
        target="hidden_iframe">

        <label>Nome completo *</label>
        <input name="nome" required>

        <div class="row">
          <div>
            <label>Qtd. Adultos *</label>
            <input id="adultos" name="adultos" type="number" min="0" value="0" required>
          </div>
          <div>
            <label>Qtd. Crian√ßas *</label>
            <input id="criancas" name="criancas" type="number" min="0" value="0" required>
          </div>
        </div>

        <div id="boxMaior7" class="fade-box">
          <label>Existe crian√ßa com 7 anos ou mais? *</label>
          <select id="maior7" name="maior7">
            <option value="">Selecione‚Ä¶</option>
            <option value="Sim">Sim</option>
            <option value="N√£o">N√£o</option>
          </select>
        </div>

        <label>Telefone (opcional)</label>
        <input name="telefone">

        <label>Observa√ß√µes (opcional)</label>
        <textarea name="obs" rows="3"></textarea>

        <button class="btn" id="sendBtn" type="submit">‚úÖ Enviar confirma√ß√£o</button>

        <div id="statusOk" class="status ok">‚úÖ Confirma√ß√£o enviada com sucesso! Pode fechar esta aba.</div>
        <div id="statusErr" class="status err"></div>
      </form>

      <div class="foot">Villa Bela Recep√ß√µes ‚Ä¢ 08/03/2026 ‚Ä¢ 16h</div>
    </div>
  </div>

  <script>
    const form = document.getElementById("rsvpForm");
    const btn = document.getElementById("sendBtn");
    const ok = document.getElementById("statusOk");
    const err = document.getElementById("statusErr");
    const iframe = document.getElementById("hidden_iframe");

    const criancasInput = document.getElementById("criancas");
    const boxMaior7 = document.getElementById("boxMaior7");
    const maior7 = document.getElementById("maior7");

    // ‚úÖ Tela final
    const finalScreen = document.getElementById("finalScreen");
    const finalClose = document.getElementById("finalClose");

    function showFinal(){
      finalScreen.classList.add("show");
      finalScreen.setAttribute("aria-hidden", "false");
    }
    function hideFinal(){
      finalScreen.classList.remove("show");
      finalScreen.setAttribute("aria-hidden", "true");
    }

    finalClose.addEventListener("click", hideFinal);
    finalScreen.addEventListener("click", (e) => {
      if (e.target === finalScreen) hideFinal();
    });
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && finalScreen.classList.contains("show")) hideFinal();
    });

    function resetStatus(){
      ok.style.display = "none";
      err.style.display = "none";
    }
    resetStatus();

    function toggleMaior7(){
      const qtd = Number(criancasInput.value || 0);
      if (qtd > 0){
        boxMaior7.classList.add("show");
      } else {
        boxMaior7.classList.remove("show");
        maior7.value = "";
      }
    }

    // Eventos robustos (mobile/iframe)
    ["input","change","keyup","blur","mouseup","touchend"].forEach(evt => {
      criancasInput.addEventListener(evt, toggleMaior7);
    });

    // Fallback: alguns celulares em iframe falham em eventos
    let lastCriancas = Number(criancasInput.value || 0);
    function watchCriancas(){
      const start = Date.now();
      const t = setInterval(() => {
        const now = Number(criancasInput.value || 0);
        if (now !== lastCriancas){
          lastCriancas = now;
          toggleMaior7();
        }
        if (Date.now() - start > 6000) clearInterval(t);
      }, 150);
    }
    criancasInput.addEventListener("focus", watchCriancas);
    criancasInput.addEventListener("click", watchCriancas);

    // ao carregar
    toggleMaior7();

    let sending = false, timeout;

    iframe.onload = () => {
      if (!sending) return;

      sending = false;
      clearTimeout(timeout);

      btn.disabled = false;
      btn.textContent = "‚úÖ Enviar confirma√ß√£o";

      ok.style.display = "block";
      form.reset();
      toggleMaior7();

      // ‚úÖ Mostra a foto final em tela cheia ap√≥s sucesso
      showFinal();
    };

    form.addEventListener("submit", (e) => {
      resetStatus();

      const adultos = Number(document.getElementById("adultos").value || 0);
      const criancas = Number(criancasInput.value || 0);

      if ((adultos + criancas) <= 0) {
        e.preventDefault();
        err.textContent = "‚ùå Informe pelo menos 1 pessoa.";
        err.style.display = "block";
        return;
      }

      if (criancas > 0 && !maior7.value) {
        e.preventDefault();
        err.textContent = "‚ùå Informe se existe crian√ßa com 7 anos ou mais.";
        err.style.display = "block";
        return;
      }

      sending = true;
      btn.disabled = true;
      btn.textContent = "Enviando...";

      timeout = setTimeout(() => {
        if (!sending) return;
        sending = false;
        btn.disabled = false;
        btn.textContent = "‚úÖ Enviar confirma√ß√£o";
        err.textContent = "‚ùå N√£o foi poss√≠vel enviar. Tente novamente.";
        err.style.display = "block";
      }, 8000);
    });
  </script>
</body>
</html>
